============================= test session starts ==============================
platform darwin -- Python 3.14.2, pytest-9.0.2, pluggy-1.6.0
rootdir: /Users/fabio.oliveira/Desktop/Projetos/study-app
plugins: anyio-4.12.1, cov-7.0.0
collected 3 items

backend/tests/test_gamification_integration.py FFF                       [100%]

=================================== FAILURES ===================================
________________________ test_xp_and_avatar_update_flow ________________________

self = <sqlalchemy.engine.base.Connection object at 0x10e59deb0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x10ccacad0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x10e46ec90>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10e4c6b50>
parameters = [('GameUserInt', 1, 0)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x10ccacad0>
cursor = <sqlite3.Cursor object at 0x10e593540>
statement = 'SELECT students.id AS students_id, students.name AS students_name, students.total_xp AS students_total_xp, students.c...shed_password, students.created_at AS students_created_at \nFROM students \nWHERE students.name = ?\n LIMIT ? OFFSET ?'
parameters = ('GameUserInt', 1, 0)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x10e46ec90>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such column: students.total_xp

backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/default.py:952: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x10e4e6660>

    def test_xp_and_avatar_update_flow(client):
        """Integration test: Register → Update Avatar → Add XP."""
    
        # 1. Register user
>       register_response = client.post("/register", json={"name": "GameUserInt", "password": "StrongPass1!"})
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_gamification_integration.py:7: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:546: in post
    return super().post(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:1144: in post
    return self.request(
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:445: in request
    return super().request(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
backend/venv/lib/python3.14/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/concurrent/futures/_base.py:450: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/concurrent/futures/_base.py:395: in __get_result
    raise self._exception
backend/venv/lib/python3.14/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/fastapi/applications.py:1135: in __call__
    await super().__call__(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
backend/venv/lib/python3.14/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/contextlib.py:162: in __exit__
    self.gen.throw(value)
backend/venv/lib/python3.14/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/app_factory.py:24: in add_security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
backend/venv/lib/python3.14/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
backend/venv/lib/python3.14/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:115: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:101: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:355: in app
    raw_response = await run_endpoint_function(
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:245: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/starlette/concurrency.py:32: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/anyio/to_thread.py:63: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
backend/venv/lib/python3.14/site-packages/anyio/_backends/_asyncio.py:2502: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/anyio/_backends/_asyncio.py:986: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
backend/modules/auth/router.py:35: in register_student
    student = auth_service.register(student_data.name, student_data.password)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/modules/auth/service.py:17: in register
    student = self.repo.create_student(name, hashed_password)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/repositories/student_repository.py:17: in create_student
    existing_student = self._get_by_name(name)
                       ^^^^^^^^^^^^^^^^^^^^^^^
backend/repositories/student_repository.py:9: in _get_by_name
    return self.db.query(Student).filter(Student.name == name).first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
backend/venv/lib/python3.14/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x10ccacad0>
cursor = <sqlite3.Cursor object at 0x10e593540>
statement = 'SELECT students.id AS students_id, students.name AS students_name, students.total_xp AS students_total_xp, students.c...shed_password, students.created_at AS students_created_at \nFROM students \nWHERE students.name = ?\n LIMIT ? OFFSET ?'
parameters = ('GameUserInt', 1, 0)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x10e46ec90>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: students.total_xp
E       [SQL: SELECT students.id AS students_id, students.name AS students_name, students.total_xp AS students_total_xp, students.current_avatar AS students_current_avatar, students.high_score AS students_high_score, students.hashed_password AS students_hashed_password, students.created_at AS students_created_at 
E       FROM students 
E       WHERE students.name = ?
E        LIMIT ? OFFSET ?]
E       [parameters: ('GameUserInt', 1, 0)]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/default.py:952: OperationalError
---------------------------- Captured stdout setup -----------------------------
DEBUG: Creating tables. Registered models: ['students', 'study_materials', 'topics', 'concepts', 'quiz_results', 'question_analytics']
_____________________ test_multiple_xp_updates_accumulate ______________________

self = <sqlalchemy.engine.base.Connection object at 0x10e641c50>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x10ccacad0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x10f262690>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10e4c6b50>
parameters = [('XPUserInt', 1, 0)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x10ccacad0>
cursor = <sqlite3.Cursor object at 0x110fcadc0>
statement = 'SELECT students.id AS students_id, students.name AS students_name, students.total_xp AS students_total_xp, students.c...shed_password, students.created_at AS students_created_at \nFROM students \nWHERE students.name = ?\n LIMIT ? OFFSET ?'
parameters = ('XPUserInt', 1, 0)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x10f262690>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such column: students.total_xp

backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/default.py:952: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x10e4e6660>

    def test_multiple_xp_updates_accumulate(client):
        """Integration test: Multiple XP updates should accumulate correctly."""
    
>       register_response = client.post("/register", json={"name": "XPUserInt", "password": "StrongPass1!"})
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_gamification_integration.py:48: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:546: in post
    return super().post(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:1144: in post
    return self.request(
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:445: in request
    return super().request(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
backend/venv/lib/python3.14/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/concurrent/futures/_base.py:450: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/concurrent/futures/_base.py:395: in __get_result
    raise self._exception
backend/venv/lib/python3.14/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/fastapi/applications.py:1135: in __call__
    await super().__call__(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
backend/venv/lib/python3.14/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/contextlib.py:162: in __exit__
    self.gen.throw(value)
backend/venv/lib/python3.14/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/app_factory.py:24: in add_security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
backend/venv/lib/python3.14/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
backend/venv/lib/python3.14/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:115: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:101: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:355: in app
    raw_response = await run_endpoint_function(
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:245: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/starlette/concurrency.py:32: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/anyio/to_thread.py:63: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
backend/venv/lib/python3.14/site-packages/anyio/_backends/_asyncio.py:2502: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/anyio/_backends/_asyncio.py:986: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
backend/modules/auth/router.py:35: in register_student
    student = auth_service.register(student_data.name, student_data.password)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/modules/auth/service.py:17: in register
    student = self.repo.create_student(name, hashed_password)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/repositories/student_repository.py:17: in create_student
    existing_student = self._get_by_name(name)
                       ^^^^^^^^^^^^^^^^^^^^^^^
backend/repositories/student_repository.py:9: in _get_by_name
    return self.db.query(Student).filter(Student.name == name).first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
backend/venv/lib/python3.14/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x10ccacad0>
cursor = <sqlite3.Cursor object at 0x110fcadc0>
statement = 'SELECT students.id AS students_id, students.name AS students_name, students.total_xp AS students_total_xp, students.c...shed_password, students.created_at AS students_created_at \nFROM students \nWHERE students.name = ?\n LIMIT ? OFFSET ?'
parameters = ('XPUserInt', 1, 0)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x10f262690>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: students.total_xp
E       [SQL: SELECT students.id AS students_id, students.name AS students_name, students.total_xp AS students_total_xp, students.current_avatar AS students_current_avatar, students.high_score AS students_high_score, students.hashed_password AS students_hashed_password, students.created_at AS students_created_at 
E       FROM students 
E       WHERE students.name = ?
E        LIMIT ? OFFSET ?]
E       [parameters: ('XPUserInt', 1, 0)]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/default.py:952: OperationalError
---------------------------- Captured stdout setup -----------------------------
DEBUG: Creating tables. Registered models: ['students', 'study_materials', 'topics', 'concepts', 'quiz_results', 'question_analytics']
___________________ test_avatar_persistence_across_sessions ____________________

self = <sqlalchemy.engine.base.Connection object at 0x10e4d26c0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x10ccacad0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x10f263a10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10e4c6b50>
parameters = [('PersistAvatarInt', 1, 0)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x10ccacad0>
cursor = <sqlite3.Cursor object at 0x10f4f1840>
statement = 'SELECT students.id AS students_id, students.name AS students_name, students.total_xp AS students_total_xp, students.c...shed_password, students.created_at AS students_created_at \nFROM students \nWHERE students.name = ?\n LIMIT ? OFFSET ?'
parameters = ('PersistAvatarInt', 1, 0)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x10f263a10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such column: students.total_xp

backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/default.py:952: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x10e4e6660>

    def test_avatar_persistence_across_sessions(client):
        """Integration test: Avatar should persist after logout/login."""
    
        # Register and set avatar
>       register_response = client.post("/register", json={"name": "PersistAvatarInt", "password": "StrongPass1!"})
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_gamification_integration.py:67: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:546: in post
    return super().post(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:1144: in post
    return self.request(
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:445: in request
    return super().request(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
backend/venv/lib/python3.14/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
backend/venv/lib/python3.14/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/concurrent/futures/_base.py:450: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/concurrent/futures/_base.py:395: in __get_result
    raise self._exception
backend/venv/lib/python3.14/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/fastapi/applications.py:1135: in __call__
    await super().__call__(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
backend/venv/lib/python3.14/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/contextlib.py:162: in __exit__
    self.gen.throw(value)
backend/venv/lib/python3.14/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/app_factory.py:24: in add_security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
backend/venv/lib/python3.14/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
backend/venv/lib/python3.14/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
backend/venv/lib/python3.14/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:115: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
backend/venv/lib/python3.14/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:101: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:355: in app
    raw_response = await run_endpoint_function(
backend/venv/lib/python3.14/site-packages/fastapi/routing.py:245: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/starlette/concurrency.py:32: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/anyio/to_thread.py:63: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
backend/venv/lib/python3.14/site-packages/anyio/_backends/_asyncio.py:2502: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/anyio/_backends/_asyncio.py:986: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
backend/modules/auth/router.py:35: in register_student
    student = auth_service.register(student_data.name, student_data.password)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/modules/auth/service.py:17: in register
    student = self.repo.create_student(name, hashed_password)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/repositories/student_repository.py:17: in create_student
    existing_student = self._get_by_name(name)
                       ^^^^^^^^^^^^^^^^^^^^^^^
backend/repositories/student_repository.py:9: in _get_by_name
    return self.db.query(Student).filter(Student.name == name).first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
backend/venv/lib/python3.14/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
backend/venv/lib/python3.14/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x10ccacad0>
cursor = <sqlite3.Cursor object at 0x10f4f1840>
statement = 'SELECT students.id AS students_id, students.name AS students_name, students.total_xp AS students_total_xp, students.c...shed_password, students.created_at AS students_created_at \nFROM students \nWHERE students.name = ?\n LIMIT ? OFFSET ?'
parameters = ('PersistAvatarInt', 1, 0)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x10f263a10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: students.total_xp
E       [SQL: SELECT students.id AS students_id, students.name AS students_name, students.total_xp AS students_total_xp, students.current_avatar AS students_current_avatar, students.high_score AS students_high_score, students.hashed_password AS students_hashed_password, students.created_at AS students_created_at 
E       FROM students 
E       WHERE students.name = ?
E        LIMIT ? OFFSET ?]
E       [parameters: ('PersistAvatarInt', 1, 0)]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

backend/venv/lib/python3.14/site-packages/sqlalchemy/engine/default.py:952: OperationalError
---------------------------- Captured stdout setup -----------------------------
DEBUG: Creating tables. Registered models: ['students', 'study_materials', 'topics', 'concepts', 'quiz_results', 'question_analytics']
=============================== warnings summary ===============================
backend/venv/lib/python3.14/site-packages/slowapi/extension.py:717
backend/venv/lib/python3.14/site-packages/slowapi/extension.py:717
  /Users/fabio.oliveira/Desktop/Projetos/study-app/backend/venv/lib/python3.14/site-packages/slowapi/extension.py:717: DeprecationWarning: 'asyncio.iscoroutinefunction' is deprecated and slated for removal in Python 3.16; use inspect.iscoroutinefunction() instead
    if asyncio.iscoroutinefunction(func):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED backend/tests/test_gamification_integration.py::test_xp_and_avatar_update_flow
FAILED backend/tests/test_gamification_integration.py::test_multiple_xp_updates_accumulate
FAILED backend/tests/test_gamification_integration.py::test_avatar_persistence_across_sessions
======================== 3 failed, 2 warnings in 1.28s =========================
